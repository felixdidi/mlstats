% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/bayes_within_between_correlations.R
\name{bayes_within_between_correlations}
\alias{bayes_within_between_correlations}
\title{Compute Bayesian Within-Group and Between-Group Correlations}
\usage{
bayes_within_between_correlations(
  data,
  group,
  vars,
  weight = TRUE,
  ci = 0.9,
  folder
)
}
\arguments{
\item{data}{A data frame containing the variables to analyze.}

\item{group}{A character string specifying the name of the grouping variable.}

\item{vars}{A character vector specifying the names of variables to correlate.}

\item{weight}{Logical. If TRUE (default), between-group correlations are weighted by group size.
If FALSE, each group contributes equally (unweighted group means).}

\item{ci}{Numeric value between 0 and 1 specifying the credible interval width
(default = 0.9 for 90\% CI).}

\item{folder}{Character string specifying the directory path where brms models
should be saved. No default; must be specified.}
}
\value{
A tibble containing a correlation matrix where:
\itemize{
\item The upper triangle contains within-group correlations
\item The lower triangle contains between-group correlations
\item Diagonal elements are marked with "-"
\item Credible correlations (CI excludes zero) are marked with "*"
}
}
\description{
This function decomposes observed correlations between variables into within-group
and between-group components using Bayesian estimation via brms. Similar to
\code{\link{within_between_correlations}}, but uses Bayesian inference with
credible intervals instead of frequentist p-values.
}
\details{
This function uses brms to estimate correlations via multivariate models with
\code{set_rescor(TRUE)}. For each pair of variables:

\strong{Within-group correlations} are computed on deviation scores (individual values
minus group means).

\strong{Between-group correlations} are handled differently based on the \code{weight} parameter:
\itemize{
\item If \code{weight = TRUE}: The correlation point estimate (median) is obtained
from a model fitted on group means replicated for each observation (implicitly
weighting by group size). However, the credible interval is always obtained from
a model fitted on unique group means only, ensuring that uncertainty reflects
the actual number of groups rather than the total sample size.
\item If \code{weight = FALSE}: Both the correlation estimate and credible interval
are obtained from a model fitted on unique group means. Each group contributes
equally regardless of size.
}

Models are saved to the specified folder for caching. Significance is determined
by whether the specified credible interval excludes zero.
}
\examples{
\dontrun{
# Create sample data
data <- data.frame(
  school = rep(1:5, each = 20),
  math_score = rnorm(100, 50, 10),
  reading_score = rnorm(100, 50, 10)
)

# Compute Bayesian within and between correlations (weighted)
result <- bayes_within_between_correlations(
  data = data,
  group = "school",
  vars = c("math_score", "reading_score"),
  ci = 0.9,
  folder = "brms_models/"
)

# Compute unweighted between-group correlations
result_unweighted <- bayes_within_between_correlations(
  data = data,
  group = "school",
  vars = c("math_score", "reading_score"),
  weight = FALSE,
  ci = 0.9,
  folder = "brms_models/"
)
}

}
\seealso{
\code{\link{within_between_correlations}} for the frequentist version
}
