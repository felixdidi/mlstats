% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/within_between_correlations.R
\name{within_between_correlations}
\alias{within_between_correlations}
\title{Compute Within-Group and Between-Group Correlations}
\usage{
within_between_correlations(
  data,
  group,
  vars,
  weight = TRUE,
  flip = FALSE,
  significance = c("basic", "detailed")
)
}
\arguments{
\item{data}{A data frame containing the variables to analyze.}

\item{group}{A character string specifying the name of the grouping variable.}

\item{vars}{A character vector specifying the names of variables to correlate.}

\item{weight}{Logical. If TRUE (default), between-group correlations are weighted by group size.
If FALSE, each group contributes equally (unweighted group means).}

\item{flip}{Logical. If TRUE, between-group correlations are shown in the upper
triangle and within-group correlations in the lower triangle. Default is FALSE.}

\item{significance}{Character string specifying the significance marking style.
Either "basic" (default) or "detailed". If "basic", correlations with p < .05
are marked with a star. If "detailed", correlations are marked with 1-3 stars
for p < .05, p < .01, or p < .001, respectively.}
}
\value{
A tibble containing a correlation matrix where:
\itemize{
\item The upper triangle contains within-group correlations
\item The lower triangle contains between-group correlations
\item Diagonal elements are marked with "-"
\item Significant correlations are marked with asterisks (see \code{significance} parameter)
}
}
\description{
This function decomposes observed correlations between variables into within-group
and between-group components following the approach of Pedhazur (1997) as originally implemented
in \code{psych::statsBy}. The decomposition follows the formula:
\deqn{r_{xy} = \eta_{x,wg} * \eta_{y,wg} * r_{xy,wg} + \eta_{x,bg} * \eta_{y,bg} * r_{xy,bg}}
}
\details{
\strong{Within-group correlations} are computed on deviation scores (individual values
minus group means).

\strong{Between-group correlations} can be computed in two ways:
\itemize{
\item If \code{weight = TRUE}: Computed on group means replicated for each observation.
This implicitly weights groups by their sample size and matches the variance
decomposition formula.
\item If \code{weight = FALSE}: Computed on unique group means only. Each group
contributes equally regardless of size.
}

The significance tests account for the effective sample size:
\itemize{
\item Within-group p-values use the total number of observations
\item Between-group p-values use the number of groups
}
}
\examples{
\dontrun{
# Create sample data
data <- data.frame(
  school = rep(1:5, each = 20),
  math_score = rnorm(100, 50, 10),
  reading_score = rnorm(100, 50, 10)
)

# Compute weighted between-group correlations (default)
result_weighted <- within_between_correlations(
  data = data,
  group = "school",
  vars = c("math_score", "reading_score")
)

# Compute unweighted between-group correlations
result_unweighted <- within_between_correlations(
  data = data,
  group = "school",
  vars = c("math_score", "reading_score"),
  weight = FALSE
)

# Use detailed significance marking
result_detailed <- within_between_correlations(
  data = data,
  group = "school",
  vars = c("math_score", "reading_score"),
  significance = "detailed"
)
}

}
\references{
Pedhazur, E. J. (1997). Multiple regression in behavioral research: explanation and prediction. Harcourt Brace.
}
\seealso{
\code{\link[psych]{statsBy}} for the original implementation
}
